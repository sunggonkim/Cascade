# Cascade: HPC ìŠ¤ì¼€ì¼ LLM ì¶”ë¡ ì„ ìœ„í•œ 4ê³„ì¸µ KV ìºì‹œ ìŠ¤í† ë¦¬ì§€

> **SC'26 ë…¼ë¬¸** | NERSC Perlmutter | A100 GPU | Slingshot-11

---

## ğŸ¯ í•µì‹¬ ê²°ê³¼: Hot/Warm/Cold ê³„ì¸µ ì„±ëŠ¥ (Job 48440231)

### 1GB ë¸”ë¡, 5íšŒ ë°˜ë³µ ì¸¡ì •

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Storage Tier Performance Comparison                        â”‚
â”‚                    Job ID: 48440231 | NVIDIA A100-SXM4-40GB                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                              â”‚
â”‚  Read Performance (GB/s) - Higher is better                                  â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  NVMe (/tmp)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 6.20     â”‚
â”‚  HOT (GPU HBM)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  6.13          â”‚
â”‚  WARM (DRAM/SHM)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  5.09             â”‚
â”‚  COLD (Lustre)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  1.33                                          â”‚
â”‚                                                                              â”‚
â”‚  Write Performance (GB/s)                                                    â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€    â”‚
â”‚  HOT (GPU HBM)    â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ 12.98   â”‚
â”‚  NVMe (/tmp)      â–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  2.35                                           â”‚
â”‚  WARM (DRAM/SHM)  â–ˆâ–ˆâ–ˆâ–ˆâ–ˆ  1.28  (Python mmap overhead)                       â”‚
â”‚  COLD (Lustre)    â–ˆâ–ˆâ–ˆâ–ˆ  0.86                                                â”‚
â”‚                                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

| Tier | Type | Write (GB/s) | Read (GB/s) | íŠ¹ì„± |
|------|------|--------------|-------------|------|
| **HOT** | GPU VRAM (HBM) | 12.98 | 6.13 | PCIe 4.0 x16 (25-32 GB/s max) |
| **WARM** | DRAM (/dev/shm) | 1.28 | 5.09 | Python mmap ì˜¤ë²„í—¤ë“œ |
| **NVMe** | Local NVMe (/tmp) | 2.35 | 6.20 | NVMe SSD |
| **COLD** | Lustre PFS | 0.86 | 1.33 | ë„¤íŠ¸ì›Œí¬ íŒŒì¼ì‹œìŠ¤í…œ (cold) |

**ì°¸ê³ **: DRAM write ì†ë„ê°€ ëŠë¦° ê²ƒì€ Python `mmap.write()` ì˜¤ë²„í—¤ë“œ ë•Œë¬¸. C++ `memcpy`ë¡œ ì¸¡ì • ì‹œ 20-50 GB/s ì˜ˆìƒ.

---

## ğŸ† ì™œ Cascadeê°€ í•„ìš”í•œê°€?

| ë¬¸ì œ | GPU-Only | Cascade |
|------|----------|---------|
| ìš©ëŸ‰ | 40GB/GPU Ã— 4 = 160GB/ë…¸ë“œ | 160GB + 256GB DRAM + PFS |
| ë©€í‹°ë…¸ë“œ | âŒ ë¶ˆê°€ëŠ¥ | âœ… MPI RMA |
| Lustre I/O | 1.33 GB/s cold | SHM ìºì‹±ìœ¼ë¡œ íšŒí”¼ |
| í”„ë¦¬íŒ¨ì¹˜ | âŒ | âœ… async prefetch |

---

## ğŸ“Š Hardware Bandwidth Reference (A100 Perlmutter)

| ê³„ì¸µ | ì´ë¡  ëŒ€ì—­í­ | ì¸¡ì •ê°’ | í™œìš©ë¥  |
|------|------------|--------|--------|
| GPU HBM | 1555 GB/s | (internal) | - |
| PCIe 4.0 x16 | 32 GB/s | 12.98 GB/s | 40% |
| DDR4 DRAM | ~200 GB/s | 5.09 GB/s (Python) | ~2.5% |
| NVMe SSD | ~7 GB/s | 6.20 GB/s | 88% |
| Lustre | variable | 1.33 GB/s | - |

---

## ğŸ”§ ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         Cascade 4-Tier Architecture                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   Tier 1: GPU HBM     â”€â”€â”€ 12.98 GB/s write â”€â”€â”€ 160GB/ë…¸ë“œ                   â”‚
â”‚      â”‚                     (PCIe 4.0 x16)                                   â”‚
â”‚      â†“ evict                                                                â”‚
â”‚   Tier 2: ë¡œì»¬ SHM    â”€â”€â”€ 5.09 GB/s read â”€â”€â”€ 256GB/ë…¸ë“œ                     â”‚
â”‚      â”‚                     (/dev/shm mmap)                                  â”‚
â”‚      â†“ MPI RMA                                                              â”‚
â”‚   Tier 3: ì›ê²© SHM    â”€â”€â”€ Slingshot-11 â”€â”€â”€ ~22 GB/s                         â”‚
â”‚      â”‚                     (GPU-aware MPI)                                  â”‚
â”‚      â†“ prefetch                                                              â”‚
â”‚   Tier 4: Lustre PFS  â”€â”€â”€ 1.33 GB/s cold â”€â”€â”€ $SCRATCH                       â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸš€ ë¹ ë¥¸ ì‹œì‘

```bash
cd /pscratch/sd/s/sgkim/Skim-cascade

# Hot/Warm/Cold ê³„ì¸µ í…ŒìŠ¤íŠ¸
sbatch benchmark/scripts/proper_bench.sh

# C++ ë¶„ì‚° ë²¤ì¹˜ë§ˆí¬ (ê°œë°œ ì¤‘)
cd cascade_Code/cpp/build_mpi
srun -n 4 ./distributed_bench --blocks 100 --block-size 10

# ê²°ê³¼ í™•ì¸
cat benchmark/results/proper_*.json | jq
```

---

## ğŸ“ˆ ë²¤ì¹˜ë§ˆí¬ Job IDs

| Job ID | í…ŒìŠ¤íŠ¸ | ê²°ê³¼ |
|--------|--------|------|
| **48440231** | Hot/Warm/Cold | âœ… GPU 12.98, NVMe 6.20, Lustre 1.33 GB/s |
| 48440157 | 6 Systems | âœ… vLLM, LMCache, PDC, HDF5 |
| 48439256 | SHM vs Lustre | âœ… 7.9Ã— faster |

---

## âš ï¸ ì•Œë ¤ì§„ ë¬¸ì œ

1. **Python mmap ì˜¤ë²„í—¤ë“œ**: DRAM write 1.28 GB/sëŠ” Python ì˜¤ë²„í—¤ë“œ. C++ êµ¬í˜„ í•„ìš”.
2. **C++ Distributed í¬ë˜ì‹œ**: MPI RMA + CUDA í†µí•© ë””ë²„ê¹… í•„ìš”.
3. **Cold read ì¸¡ì •**: `posix_fadvise(DONTNEED)` ì‚¬ìš©í•˜ì—¬ page cache drop.

---

## ğŸ”¬ ì‹¤í—˜ í™˜ê²½ (Perlmutter)

| êµ¬ì„±ìš”ì†Œ | ì‚¬ì–‘ |
|---------|------|
| **GPU** | NVIDIA A100-SXM4-40GB Ã— 4 = 160GB HBM/ë…¸ë“œ |
| **CPU** | AMD EPYC 7763 (64 cores) |
| **DRAM** | 256GB DDR4/ë…¸ë“œ |
| **NVMe** | /tmp: ~1.9TB per node |
| **ì¸í„°ì»¤ë„¥íŠ¸** | Slingshot-11 (200 Gb/s Ã— 4 NIC) |
| **ìŠ¤í† ë¦¬ì§€** | Lustre $SCRATCH (44PB) |

---

**Last Updated**: 2026-02-02  
**Author**: Sunggon Kim (sgkim@lbl.gov)  
**Latest Job**: 48440231
