# Cascade: HPC 스케일 LLM 추론을 위한 4계층 KV 캐시 스토리지

> **SC'26 논문** | NERSC Perlmutter | A100 GPU | Slingshot-11

---

## 🎯 핵심 결과 (실제 벤치마크)

### Job 48440157: 6개 시스템 비교 (1GB 데이터)

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                    Storage System Comparison (4 nodes)                       │
│                    Job ID: 48440157 | 2026-02-02                             │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  Read Performance (GB/s)                                                     │
│  ────────────────────────────────────────────────────────────────────────    │
│  vLLM (GPU)     ████████████████████████████████████████ 7.59               │
│  LMCache        ██████████████████████████ 4.96                             │
│  Cascade (SHM)  ██████████████████████ 4.24                                 │
│  PDC (fsync)    ████████████████████ 3.78                                   │
│  HDF5           ███████████████████ 3.68                                    │
│                                                                              │
│  Write Performance (GB/s)                                                    │
│  ────────────────────────────────────────────────────────────────────────    │
│  vLLM (GPU)     █████████████████████████████████████████████ 8.88          │
│  HDF5           ████████████████ 3.05                                       │
│  LMCache        ███████████████ 3.03                                        │
│  PDC (fsync)    ███████████████ 3.03                                        │
│  Cascade (SHM)  ████████ 1.45                                               │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

| System | Type | Write (GB/s) | Read (GB/s) | 비고 |
|--------|------|--------------|-------------|------|
| **vLLM** | GPU HBM | 8.88 | 7.59 | PCIe 대역폭 |
| **LMCache** | File-based | 3.03 | 4.96 | /tmp NVMe |
| **Cascade** | SHM mmap | 1.45 | 4.24 | /dev/shm |
| **PDC** | fsync | 3.03 | 3.78 | 동기 I/O |
| **HDF5** | Hierarchical | 3.05 | 3.68 | h5py |

---

## 🏆 비교 테스트 대상 시스템

| 시스템 | 유형 | 장점 | HPC 스케일 한계 |
|--------|------|------|-----------------|
| **vLLM** | GPU HBM | 가장 빠른 접근 | GPU당 40GB 용량 제한 |
| **LMCache** | 파일 기반 | 세션 분리 | 싱글노드 전용 |
| **PDC** | 객체 스토리지 | 데이터 영속성 | fsync 오버헤드 |
| **Redis** | 인메모리 KV | 범용성 | 네트워크 직렬화 |
| **HDF5** | 계층적 파일 | 표준 포맷 | 확장성 제한 |
| **Cascade** | 4-tier SHM | 멀티노드 | SC'26 신규 제안 |

---

## 📊 추가 벤치마크 결과

### Job 48439256: SHM vs Lustre Cold Read

```
┌──────────────────────────────────────────────────────────────────────────────┐
│                    SHM vs Lustre Cold Read 비교                              │
│                    Job ID: 48439256 (4 nodes)                                │
├──────────────────────────────────────────────────────────────────────────────┤
│                                                                              │
│  📊 성능 비교                                                                 │
│  ────────────────────────────────────────────────────────────────────────    │
│  SHM mmap   ████████████████████████████████████████████ 8.61 GB/s/node     │
│  Lustre     █████ 1.09 GB/s/node (cold read)                                │
│                                                                              │
│  ⚡ Speedup: 7.9× faster                                                      │
│                                                                              │
└──────────────────────────────────────────────────────────────────────────────┘
```

### Job 48439317: Large Scale (209.7 GB)

| Metric | Value |
|--------|-------|
| Total Data | 209.7 GB (52.4 GB/node × 4 nodes) |
| Aggregate Write | 12.46 GB/s |
| Aggregate Read | 17.06 GB/s |

---

## 🔧 시스템 아키텍처

```
┌─────────────────────────────────────────────────────────────────────────────┐
│                         Cascade 4-Tier Architecture                          │
├─────────────────────────────────────────────────────────────────────────────┤
│                                                                             │
│   Tier 1: GPU HBM     ─── ~8 GB/s (PCIe) ─── 40GB × 4 = 160GB/노드          │
│      │                     (NVIDIA A100)                                    │
│      ↓ evict                                                                │
│   Tier 2: 로컬 SHM    ─── ~8 GB/s ─── /dev/shm 256GB/노드                   │
│      │                     (mmap direct access)                             │
│      ↓ MPI RMA                                                              │
│   Tier 3: 원격 SHM    ─── Slingshot-11 ─── 22.8 GB/s                        │
│      │                     (GPU-aware MPI)                                  │
│      ↓ prefetch                                                              │
│   Tier 4: Lustre PFS  ─── 1.1 GB/s (cold) ─── $SCRATCH                      │
│                                                                             │
└─────────────────────────────────────────────────────────────────────────────┘
```

---

## 🚀 빠른 시작

```bash
cd /pscratch/sd/s/sgkim/Skim-cascade

# 6개 시스템 비교 벤치마크
sbatch benchmark/scripts/full_6sys_bench.sh

# 결과 확인
cat benchmark/logs/full_6sys_*.out | tail -50
```

---

## 📈 벤치마크 Job IDs (재현 가능)

| Job ID | 테스트 | 결과 |
|--------|--------|------|
| **48440157** | 6 Systems | ✅ vLLM, LMCache, PDC, HDF5, Cascade |
| 48439256 | SHM vs Lustre | ✅ 7.9× faster |
| 48439317 | Large Scale | ✅ 17.1 GB/s (209.7 GB) |

---

## 🔬 실험 환경 (Perlmutter)

| 구성요소 | 사양 |
|---------|------|
| **GPU** | NVIDIA A100-40GB × 4 = 160GB HBM/노드 |
| **CPU** | AMD EPYC 7763 (64 cores) |
| **DRAM** | 256GB DDR4/노드 |
| **SHM** | /dev/shm: ~135GB 사용 가능 |
| **인터커넥트** | Slingshot-11 (200 Gb/s × 4 NIC) |
| **스토리지** | Lustre $SCRATCH (44PB, 7.8 TB/s aggregate) |

---

## 🚨 연구 윤리

**필수:**
- ✅ 실제 시스템 코드 사용 (torch, h5py)  
- ✅ SLURM Job ID로 재현 가능
- ✅ 모든 환경 정보 명시

**금지:**
- ❌ 시뮬레이션 결과를 실험 결과로 제시
- ❌ 선별적 결과만 보고

---

**Last Updated**: 2026-02-02  
**Author**: Sunggon Kim (sgkim@lbl.gov)  
**Job ID**: 48440157
